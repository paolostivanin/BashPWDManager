#!/bin/bash

#################################################################
# @Author: Paolo Stivanin aka Polslinux
# @Name: Bash Password Manager Configuration Script
# @Copyright: 2011
# @Site: http://www.polslinux.it
# @License: GNU AGPL v3 http://www.gnu.org/licenses/agpl.html
#################################################################

IFS=$'\n'
version="0.1-alpha4"
conf_file="/home/$USER/.config/bpwdman.conf"

function first_encryption(){
 typ_algo=`echo $typ | tr '[A-Z]' '[a-z]'`
 gpg -o $db_dir/enc_db --cipher-algo=$typ -c $db_dir/$db_name
 mv $db_dir/enc_db $db_dir/$db_name
}

function save_db_path(){
zenity --question --text "Do you want to save the path to DB so every time you
start the script you won't have to select it?" --title "Save DB path?" --width=410
if [ "$?" == "0" ] ; then
 echo "database-path=$db_dir" >> $conf_file   
 elif [ "$?" != "0" ] ; then
   echo "database-path=0" >> $conf_file
fi
}

if [ ! -f $conf_file ] ; then
 typ=$(zenity  --list  --text "What type of cipher algo do you want to use?" --radiolist  --column "Choice" --column "Type" TRUE CAST5 FALSE 3DES FALSE AES256 FALSE TWOFISH FALSE BLOWFISH)
 echo "algo=$typ"  | tr '[A-Z]' '[a-z]' >> $conf_file
 db_dir=`zenity --file-selection --directory --title "Choose database directory"`
 db_name=`zenity --entry --title "Database name" --text "Write the name of your database"`
 touch $db_dir/$db_name
 echo "db_created=1" >> $conf_file
 save_db_path
 first_encryption
 unset typ
 unset db_dir
 unset db_name
 zenity --info --text "Bash Password Manager has been configured!" --title "All done!" --width=400
elif [ -f $conf_file ] ; then
 zenity --info --text "Bash Password Manager has already been configured!" --title "All done!" --width=400
 exit 0
fi
